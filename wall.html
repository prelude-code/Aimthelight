<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Light Wall — Aim the Light</title>
<meta name="description" content="Contribute one word or phrase that we need more of right now — and watch it join the Light Wall." />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,600;0,800;1,400;1,600;1,800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1222; --ink:#f8fafc; --muted:#9db2d1; --accent:#fbbf24;
    --panel:#0f1830; --panel2:#0b1222; --border:#223156;
    --max:1100px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.6}
  a{color:var(--accent);text-decoration:none}
  .container{max-width:var(--max);margin:0 auto;padding:0 1.1rem}

  /* Header (minimal) */
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, rgba(15,23,42,.9), rgba(15,23,42,0));
    backdrop-filter:saturate(120%) blur(6px);
    border-bottom:1px solid rgba(31,39,55,.35);
  }
  .nav{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
  .brand a{font-weight:800;white-space:nowrap;color:inherit}
  nav.links a{color:var(--accent);margin-left:.9rem;font-weight:600}

  /* Hero */
  .hero{
    min-height:32vh; display:grid; place-items:center; text-align:center; position:relative; isolation:isolate;
    border-bottom:1px solid #1f2737;
  }
  .hero::before{
    content:""; position:absolute; inset:0; z-index:-2;
    background: radial-gradient(1000px 400px at 10% -10%, rgba(251,191,36,.08), transparent 60%),
                radial-gradient(900px 520px at 120% 0%, rgba(147,197,253,.08), transparent 60%),
                linear-gradient(180deg,#0f1830,#0b1222 60%, #0b1222);
  }
  .hero h1{font-size:clamp(1.9rem,1.3rem + 2.4vw,3rem);margin:.25rem 0 .4rem;font-weight:800}
  .hero p{color:var(--muted);margin:0}

  /* Card */
  .card{
    border:1px solid var(--border); border-radius:16px; background:linear-gradient(180deg,#101a30,#0b1222);
    box-shadow:0 10px 24px rgba(0,0,0,.28);
  }

  .grid{display:grid; gap:1.2rem}
  @media(min-width:980px){ .grid{grid-template-columns:1.1fr .9fr} }

  .form{
    padding:16px; display:grid; gap:.8rem;
  }
  .row{display:flex; gap:.6rem}
  .row > * { flex:1 }
  input, textarea, button{
    width:100%; padding:.75rem .85rem; border-radius:12px; border:1px solid #294068; background:#0d172b; color:var(--ink);
    font:inherit;
  }
  input::placeholder, textarea::placeholder{ color:#7891b4 }
  textarea{min-height:86px; resize:vertical}
  button{
    background:var(--accent); color:#090909; font-weight:800; cursor:pointer;
    border:1px solid #c08c10; box-shadow:0 6px 18px rgba(251,191,36,.18);
  }
  button:disabled{opacity:.5; cursor:not-allowed}

  .hint{font-size:.95rem; color:var(--muted); padding:0 16px 12px}
  #msg{min-height:1.2rem; color:#ffe8a6; padding:0 16px 8px}

  /* Wall & Leaderboard wrapper */
  .showcase{display:grid; gap:1.2rem}
  @media(min-width:980px){ .showcase{grid-template-columns:1fr 380px} }

  /* Wall container */
  .wall{
    position:relative; min-height:520px; border:1px solid var(--border); border-radius:14px;
    overflow:hidden;
    background:
      radial-gradient(1200px 480px at 15% -10%, rgba(251,191,36,.05), transparent 60%),
      radial-gradient(900px 520px at 120% 0%, rgba(147,197,253,.06), transparent 60%),
      linear-gradient(180deg,#0f1830,#0b1222 60%, #0b1222);
  }
  .wall.locked{ filter:saturate(.6) blur(.5px) }
  .wall .overlay{
    position:absolute; inset:0; display:grid; place-items:center; background:rgba(11,18,34,.55);
    color:#dbe6fb; text-align:center; padding:1.2rem; font-weight:600;
  }
  .wall::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background: radial-gradient(800px 300px at 70% 110%, rgba(255,255,255,.02), transparent 60%);
  }

  /* Tag styling with gradient text */
  .tag{
    position:absolute; white-space:nowrap;
    font-weight:800; letter-spacing:.2px;
    color: transparent;
    -webkit-background-clip:text; background-clip:text;
    text-shadow:0 1px 0 rgba(0,0,0,.35);
    opacity:.92; transition:opacity .18s ease, transform .18s ease;
    pointer-events:auto; user-select:none; cursor:default;
    transform:translateZ(0);
    --h:210; --s:40%; --l:78%;
    --h2:calc(var(--h) + 10); --s2:calc(var(--s) + 6%); --l2:calc(var(--l) - 6%);
    background-image: linear-gradient(
      90deg,
      hsl(var(--h)  var(--s)  var(--l)),
      hsl(var(--h2) var(--s2) var(--l2))
    );
  }
  .tag .count{ color:#ffe8a6; margin-left:.35rem }
  .tag:hover{ opacity:1; transform:translateY(-1px) }
  .tag.top{ text-shadow:0 2px 10px rgba(255,255,255,.06), 0 1px 0 rgba(0,0,0,.4);
            filter: drop-shadow(0 4px 14px rgba(251,191,36,.08)); }

  /* Leaderboard */
  .board{ border:1px solid var(--border); border-radius:14px; overflow:hidden; }
  .board h3{ margin:0; padding:12px 14px; border-bottom:1px solid var(--border); background:#0e172c }
  .board .list{ padding:10px 12px }
  .board .row{
    display:flex; justify-content:space-between; align-items:center;
    padding:10px 8px; border-bottom:1px dashed #1e2c49;
  }
  .board .row:last-child{ border-bottom:0 }
  .term{ font-weight:800 }
  .who{ color:#9ab1d3; font-size:.95rem }
  .cnt{ color:#ffe8a6; font-weight:800 }

  /* Tiny helper text */
  .muted{ color:var(--muted) }
</style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><a href="index.html">Aim the Light</a></div>
      <nav class="links">
        <a href="index.html#mission">Mission</a>
        <a href="index.html#approach">Approach</a>
        <a href="essay.html">Essay</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h1>Light Wall</h1>
      <p>Share one word or short phrase we need more of right now.</p>
    </div>
  </section>

  <main class="container" style="padding:28px 0 56px">
    <!-- Submit card -->
    <div class="card">
      <form id="f" class="form" autocomplete="off">
        <div class="row">
          <input id="word" name="word" minlength="1" maxlength="40" placeholder="Your word or short phrase" required>
          <input id="name" name="name" maxlength="40" placeholder="Optional name">
        </div>
        <button id="addBtn" type="submit">Add to Light</button>
        <div id="msg"></div>
      </form>
      <div class="hint">Once you post, the Wall and Leaderboard unlock and your word joins the collective signal.</div>
    </div>

    <div class="showcase" style="margin-top:14px">
      <!-- Wall -->
      <div class="card" style="padding:12px">
        <div id="wall" class="wall locked">
          <div id="overlay" class="overlay">
            Post once to unlock the Wall.
          </div>
        </div>
      </div>

      <!-- Leaderboard -->
      <aside class="board card">
        <h3>Leaderboard</h3>
        <div id="board" class="list">
          <div class="muted" id="boardHint" style="padding:8px 4px">Post to reveal the current top terms.</div>
        </div>
      </aside>
    </div>
  </main>

<script>
/* =========================
   Lightweight data & utils
   ========================= */
const STORAGE_KEY = 'atl_lightwall_v1';
const REQUIRE_POST_TO_UNLOCK = true;

function loadData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return seedData();
    const d = JSON.parse(raw);
    if (!Array.isArray(d)) return seedData();
    return d;
  }catch(_){ return seedData(); }
}
function saveData(list){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }catch(_){}
}
function seedData(){
  // Polite initial seeds, low counts so your visitors take over quickly
  const seeds = [
    {term:'empathy', count:6, first_by:'Anonymous'},
    {term:'grace', count:4, first_by:'Anonymous'},
    {term:'patience', count:3, first_by:'Anonymous'},
    {term:'truth', count:3, first_by:'Anonymous'},
    {term:'listening', count:2, first_by:'Anonymous'},
    {term:'courage', count:2, first_by:'Anonymous'}
  ];
  saveData(seeds);
  return seeds;
}

function cap(s){ return (s||'').charAt(0).toUpperCase() + (s||'').slice(1); }
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }
function slugify(s){ return (s||'').toLowerCase().trim()
  .replace(/[^\w\s-]/g,'').replace(/\s+/g,' ').replace(/\s/g,'-'); }

/* Hash + color families */
function hash(str){ let h=2166136261>>>0; for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=(h*16777619)>>>0;} return h>>>0; }
function baseHue(term){
  const families = [210, 280, 25, 145, 355]; // slate/indigo, violet, amber, teal, crimson
  const fam = families[ hash(term) % families.length ];
  const jitter = (hash(term+'j') % 20) - 10; // -10..+9
  return (fam + jitter + 360) % 360;
}
function satFor(rank){ return 34 + Math.round(rank * 22); }   // 34%..56%
function lightFor(rank){ return 80 - Math.round(rank * 10); } // 80%..70%
function secondaryHue(h){ return (h + 12) % 360; }

/* =========================
   DOM refs
   ========================= */
const form   = document.getElementById('f');
const wordEl = document.getElementById('word');
const nameEl = document.getElementById('name');
const msgEl  = document.getElementById('msg');
const wallEl = document.getElementById('wall');
const overlayEl = document.getElementById('overlay');
const boardEl = document.getElementById('board');
const boardHintEl = document.getElementById('boardHint');

let DATA = loadData();

/* =========================
   Wall layout engine
   ========================= */
const wallState = { width:0, height:0, tags:[] };

function resizeWall(){
  const rect = wallEl.getBoundingClientRect();
  wallState.width = rect.width;
  wallState.height = Math.max(520, rect.width * (window.innerWidth > 980 ? 0.58 : 0.78));
  wallEl.style.minHeight = wallState.height + 'px';
}
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

function layoutTags(){
  const padding = 16;
  const maxX = wallState.width  - padding;
  const maxY = wallState.height - padding;

  // initial placement from normalized coords
  wallState.tags.forEach(tag=>{
    tag.x = clamp(tag.nx * (wallState.width  - tag.w - padding*2) + padding, padding, maxX - tag.w);
    tag.y = clamp(tag.ny * (wallState.height - tag.h - padding*2) + padding, padding, maxY - tag.h);
  });

  // resolve overlaps with a few passes
  const passes = 4;
  for (let p=0; p<passes; p++){
    for (let i=0; i<wallState.tags.length; i++){
      const a = wallState.tags[i];
      for (let j=i+1; j<wallState.tags.length; j++){
        const b = wallState.tags[j];
        if (a.x > b.x + b.w || b.x > a.x + a.w || a.y > b.y + b.h || b.y > a.y + a.h) continue;
        const dx = (a.x + a.w/2) - (b.x + b.w/2);
        const dy = (a.y + a.h/2) - (b.y + b.h/2);
        const push = 6;
        const len = Math.hypot(dx, dy) || 1;
        const ux = (dx/len) * push, uy = (dy/len) * push;
        a.x = clamp(a.x + ux, padding, maxX - a.w);
        a.y = clamp(a.y + uy, padding, maxY - a.h);
        b.x = clamp(b.x - ux, padding, maxX - b.w);
        b.y = clamp(b.y - uy, padding, maxY - b.h);
      }
    }
  }

  // apply
  wallState.tags.forEach(tag=>{
    tag.el.style.left = Math.round(tag.x) + 'px';
    tag.el.style.top  = Math.round(tag.y) + 'px';
  });
}

function buildWall(list){
  // clear
  wallEl.querySelectorAll('.tag').forEach(n=>n.remove());
  wallState.tags = [];
  if (!list.length) return;

  const maxCount = Math.max(...list.map(x=>x.count));
  const minSize = 12, maxSize = 28;
  const topTerms = [...list].sort((a,b)=>b.count-a.count).slice(0,3).map(x=>x.term);

  // create + measure
  const frag = document.createDocumentFragment();
  list.forEach((it, idx)=>{
    const rank = (it.count - 1) / Math.max(1, (maxCount - 1)); // 0..1
    const h = baseHue(it.term);
    const s = satFor(rank);
    const l = lightFor(rank);
    const h2 = secondaryHue(h);

    const el = document.createElement('div');
    el.className = 'tag' + (topTerms.includes(it.term) ? ' top' : '');

    // font size
    const size = minSize + Math.sqrt(it.count/(maxCount||1))*(maxSize - minSize);
    el.style.fontSize = size.toFixed(1) + 'px';

    // gradient variables
    el.style.setProperty('--h',  h);
    el.style.setProperty('--s',  s + '%');
    el.style.setProperty('--l',  l + '%');
    el.style.setProperty('--h2', h2);
    el.style.setProperty('--s2', Math.min(60, s+6) + '%');
    el.style.setProperty('--l2', Math.max(58, l-6) + '%');

    el.innerHTML = `${escapeHtml(cap(it.term))}<span class="count">×${it.count}</span>`;

    // offscreen temp placement
    el.style.left = '-9999px'; el.style.top = '-9999px';
    frag.appendChild(el);

    // normalized seed positions (stable + slight randomness)
    const nx = (idx * 0.37 % 1 + (hash(it.term) % 100)/1000) % 1;
    const ny = (idx * 0.53 % 1 + (hash(it.term+'y') % 100)/1000) % 1;

    wallState.tags.push({ el, data:it, nx, ny, w:0, h:0, x:0, y:0 });

    el.addEventListener('click', ()=>{
      msgEl.textContent = `${cap(it.term)} is at ×${it.count}.`;
    });
  });

  wallEl.appendChild(frag);

  // measure sizes
  wallState.tags.forEach(tag=>{
    const r = tag.el.getBoundingClientRect();
    tag.w = r.width; tag.h = r.height;
  });

  // size + layout
  resizeWall();
  layoutTags();

  // gentle fade-up on (re)build
  wallState.tags.forEach(t=>{
    t.el.style.opacity = 0;
    t.el.style.transform = 'translateY(6px)';
    requestAnimationFrame(()=>{
      t.el.style.transition = 'opacity .35s ease, transform .35s ease';
      t.el.style.opacity = 1;
      t.el.style.transform = 'none';
    });
  });
}

/* =========================
   Leaderboard
   ========================= */
function buildBoard(list, unlocked){
  boardEl.innerHTML = '';
  if (!unlocked){
    boardEl.appendChild(boardHintEl);
    return;
  }
  const ul = document.createElement('div');
  ul.className = 'list';
  [...list].sort((a,b)=>b.count-a.count).slice(0,20).forEach((it,i)=>{
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `
      <div>
        <div class="term">${escapeHtml(cap(it.term))}</div>
        <div class="who">${escapeHtml(it.first_by || 'Anonymous')}</div>
      </div>
      <div class="cnt">×${it.count}</div>
    `;
    ul.appendChild(row);
  });
  boardEl.appendChild(ul);
}

/* =========================
   Unlock gating
   ========================= */
function hasContributed(){ return localStorage.getItem('atl_contrib_v1') === '1'; }
function setContributed(){ localStorage.setItem('atl_contrib_v1','1'); }
function gate(unlock){
  if (REQUIRE_POST_TO_UNLOCK && !unlock){
    wallEl.classList.add('locked');
    overlayEl.style.display = 'grid';
    buildBoard(DATA, false);
  }else{
    wallEl.classList.remove('locked');
    overlayEl.style.display = 'none';
    buildBoard(DATA, true);
  }
}

/* =========================
   Submit handling
   ========================= */
form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const raw = (wordEl.value || '').trim();
  if (!raw) return;
  const term = raw.replace(/\s+/g,' ').slice(0,40);
  const who  = (nameEl.value || 'Anonymous').trim().slice(0,40);

  // upsert
  const key = slugify(term);
  let found = DATA.find(x => slugify(x.term) === key);
  if (found){
    found.count += 1;
  }else{
    found = { term, count:1, first_by: who || 'Anonymous' };
    DATA.push(found);
  }
  saveData(DATA);
  setContributed();

  msgEl.textContent = `Added “${term}”.`;
  wordEl.value = '';
  // Rebuild views
  buildWall(DATA);
  gate(true);
});

/* =========================
   Init
   ========================= */
function init(){
  // initial views
  const unlocked = !REQUIRE_POST_TO_UNLOCK || hasContributed();
  gate(unlocked);
  buildWall(unlocked ? DATA : []); // keep hidden until posted

  // responsive
  let t;
  window.addEventListener('resize', ()=>{
    clearTimeout(t);
    t = setTimeout(()=>{ resizeWall(); layoutTags(); }, 80);
  });
}
init();
</script>
</body>
</html>