<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Light Wall — Aim the Light</title>
<meta name="description" content="Pin your reflection to a living wall. Add a name (optional) and watch it fly into place." />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1020; --ink:#f8fafc; --muted:#94a3b8; --accent:#fbbf24;
    --max:1200px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* Header (match your site) */
  header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(15,23,42,.9), rgba(15,23,42,0));backdrop-filter:saturate(120%) blur(6px)}
  .nav{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
  .brand{font-weight:800;letter-spacing:.3px}
  .nav a{color:var(--ink);text-decoration:none}
  .nav a.btn{background:var(--accent);color:#0b0b0b;padding:.45rem .75rem;border-radius:10px;font-weight:600}

  /* Full-bleed wall background */
  .stage{
    position:relative;
    min-height: calc(100vh - 64px);
    /* Subtle “city + light” vibe; replace with your own image if you like */
    background:
      radial-gradient(1200px 600px at 70% 0%, rgba(251,191,36,.25), transparent 60%),
      radial-gradient(900px 500px at 10% 30%, rgba(96,165,250,.18), transparent 60%),
      url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=2000&auto=format&fit=crop");
    background-size: cover;
    background-position: center;
    overflow: hidden;
    border-top:1px solid rgba(255,255,255,.06);
  }

  /* Dark scrim for legibility */
  .scrim{
    position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(7,10,20,.65), rgba(7,10,20,.80));
  }

  /* Content rails */
  .frame{position:relative; z-index:1; max-width:var(--max); margin:0 auto; padding:18px 16px 64px}

  /* Composer panel (floating card) */
  .composer{
    display:grid; gap:10px; grid-template-columns: 1fr auto;
    border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(17,24,39,.85), rgba(12,19,34,.85));
    backdrop-filter: blur(4px);
    border-radius:16px; padding:14px; margin:10px 0 18px 0;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  @media (max-width:800px){ .composer{grid-template-columns:1fr} }
  .composer .fields{display:grid; grid-template-columns: 1fr 220px; gap:10px}
  @media (max-width:800px){ .composer .fields{grid-template-columns:1fr} }

  input[type="text"], textarea, select{
    width:100%; border:1px solid #2b3a52; border-radius:12px; background:#0c1322;
    color:#e5e7eb; padding:10px 12px; font-size:1rem; outline:none;
  }
  textarea{min-height:96px; resize:vertical}
  .meta-row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .muted{color:var(--muted); font-size:.9rem}
  .chip{display:inline-flex;align-items:center;gap:.4rem;border:1px solid #344155;background:rgba(17,24,39,.5);padding:.45rem .7rem;border-radius:999px;color:var(--ink);font-weight:600}
  .btn{background:var(--accent);color:#0b0b0b;padding:.6rem 1rem;border-radius:12px;border:none;font-weight:800;cursor:pointer}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .counter{font-variant-numeric:tabular-nums}

  /* Full-page “wall” grid */
  .wall{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap:14px;
    align-content:start;
    min-height: 60vh;
  }

  /* Colorful tiles (sticky-notes vibe) */
  .tile{
    position:relative; padding:12px 12px 10px; border-radius:14px; color:#0b0b0b;
    box-shadow:0 12px 24px rgba(0,0,0,.28), 0 0 0 1px rgba(255,255,255,.04) inset;
    transform: rotate(var(--rot,0deg));
    background: var(--col, #ffe8a6);
  }
  .tile .text{white-space:pre-wrap; line-height:1.25; color:#0b0b0b}
  .tile .meta{
    margin-top:8px; display:flex; justify-content:space-between; align-items:center; font-size:.82rem;
    border-top:1px solid rgba(0,0,0,.12); padding-top:8px; color:#1f2937;
  }
  .tag{
    border:1px solid rgba(0,0,0,.18);
    background:rgba(255,255,255,.5);
    backdrop-filter: blur(2px);
    padding:.06rem .45rem; border-radius:999px; font-size:.78rem; color:#0b0b0b;
  }
  .name{font-weight:700}

  /* Tape detail */
  .tile:before{
    content:""; position:absolute; left:50%; top:-8px; transform:translateX(-50%) rotate(-1deg);
    width:46px; height:14px; border-radius:4px;
    background:linear-gradient(180deg,rgba(255,255,255,.22),rgba(255,255,255,.06));
    border:1px solid rgba(0,0,0,.15);
    box-shadow:0 2px 6px rgba(0,0,0,.3);
  }

  /* Flying ghost on submit */
  .fly{
    position:fixed; left:0; top:0; width:220px; z-index:9999; pointer-events:none;
    padding:12px; border-radius:14px; color:#0b0b0b;
    background: var(--col, #ffe8a6);
    box-shadow:0 12px 24px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
  }

  /* Footer */
  footer{position:relative; z-index:1; padding:42px 0; text-align:center; color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><a href="index.html" style="color:inherit;text-decoration:none">Aim the Light</a></div>
    <nav class="links" aria-label="Primary">
      <a class="muted" href="index.html#mission">Mission</a>
      &nbsp;·&nbsp;<a class="muted" href="index.html#approach">Approach</a>
      &nbsp;·&nbsp;<a class="muted" href="essay.html">Essay</a>
      &nbsp;·&nbsp;<a class="muted" href="wall.html" aria-current="page">Light Wall</a>
    </nav>
    <a class="btn" href="index.html#join">Join</a>
  </div>
</header>

<section class="stage">
  <div class="scrim"></div>
  <div class="frame">
    <!-- Composer -->
    <div class="composer" id="composer">
      <div class="fields">
        <textarea id="msg" maxlength="160" placeholder="Light is... (max 160)"></textarea>
        <div>
          <input id="name" type="text" placeholder="Name (optional)" />
          <select id="tone" style="margin-top:10px">
            <option value="">Tag (optional)</option>
            <option>Hope</option><option>Resolve</option><option>Gratitude</option>
            <option>Clarity</option><option>Action</option>
          </select>
        </div>
      </div>
      <div class="meta-row">
        <span class="chip counter" id="count">0/160</span>
        <label class="muted"><input type="checkbox" id="consent"> I agree to public display</label>
        <span class="muted" id="hint"></span>
        <div style="flex:1"></div>
        <button class="btn" id="postBtn" disabled>Pin to Wall</button>
      </div>
    </div>

    <!-- Wall -->
    <div id="wall" class="wall" aria-live="polite"></div>
  </div>
</section>

<footer>
  <p>© <span id="y"></span> Aim the Light • <a href="mailto:info@aimthelight.org">info@aimthelight.org</a></p>
</footer>

<script>
  // Year
  document.getElementById('y').textContent = new Date().getFullYear();

  // Local demo storage
  const STORE_KEY = 'lightwall_tiles_v2';
  const RATE_KEY  = 'lightwall_last_ms';
  const MIN_WAIT  = 45 * 1000; // 45s

  const wall  = document.getElementById('wall');
  const msg   = document.getElementById('msg');
  const nameI = document.getElementById('name');
  const tone  = document.getElementById('tone');
  const count = document.getElementById('count');
  const post  = document.getElementById('postBtn');
  const ok    = document.getElementById('consent');
  const hint  = document.getElementById('hint');
  const composer = document.getElementById('composer');

  const colors = [
    '#ffe8a6', '#ffd2cc', '#d9f99d', '#bae6fd', '#c7d2fe',
    '#fecaca', '#a7f3d0', '#fde68a', '#fbcfe8', '#bbf7d0'
  ];
  const bad = ['fuck','shit','bitch','asshole','cunt','nigger','faggot']; // demo filter
  const clean = t => !bad.some(w => t.toLowerCase().includes(w));

  function load(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)||'[]'); }catch{ return []; } }
  function save(list){ localStorage.setItem(STORE_KEY, JSON.stringify(list)); }
  function rng(min,max){ return Math.random()*(max-min)+min; }

  function tileEl(tile){
    const el = document.createElement('article');
    el.className = 'tile';
    el.style.setProperty('--rot', (rng(-2.2,2.2)).toFixed(2) + 'deg');
    el.style.setProperty('--col', tile.col || colors[Math.floor(Math.random()*colors.length)]);

    const t = document.createElement('div');
    t.className = 'text';
    t.textContent = tile.text;

    const meta = document.createElement('div');
    meta.className = 'meta';
    const left = document.createElement('span');
    left.innerHTML = (tile.name ? `<span class="name">${escapeHtml(tile.name)}</span>` : '<span class="name">Anonymous</span>')
                     + ' · ' + new Date(tile.ts).toLocaleString();
    const tag = document.createElement('span');
    tag.className = 'tag';
    tag.textContent = tile.tone || 'Reflection';
    meta.append(left, tag);

    el.append(t, meta);
    return el;
  }

  function render(){
    const tiles = load().sort((a,b)=>b.ts - a.ts);
    wall.innerHTML = '';
    tiles.forEach(t => wall.appendChild(tileEl(t)));
  }

  function update(){
    const len = msg.value.trim().length;
    count.textContent = len + '/160';
    const can = len>0 && len<=160 && ok.checked && clean(msg.value);
    post.disabled = !can;
    hint.textContent = can ? '' : (!ok.checked ? 'Consent required.' : (!clean(msg.value) ? 'Please keep it respectful.' : ''));
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
  }

  msg.addEventListener('input', update);
  ok.addEventListener('change', update);
  update(); render();

  // Post + fly animation
  post.addEventListener('click', ()=>{
    const text = msg.value.trim();
    if (!text) return;

    const now = Date.now();
    const last = Number(localStorage.getItem(RATE_KEY)||0);
    const wait = MIN_WAIT - (now - last);
    if (wait > 0){ hint.textContent = `Please wait ${Math.ceil(wait/1000)}s before posting again.`; return; }
    if (!clean(text)){ hint.textContent='Please keep it respectful.'; return; }

    const data = {
      id: crypto.randomUUID(),
      text,
      name: nameI.value.trim(),
      tone: tone.value || '',
      col: colors[Math.floor(Math.random()*colors.length)],
      ts: now
    };

    // Prepend hidden tile to measure target
    const real = tileEl(data);
    real.style.visibility = 'hidden';
    wall.prepend(real);
    const targetRect = real.getBoundingClientRect();

    // Create flying ghost near composer
    const compRect = composer.getBoundingClientRect();
    const fly = document.createElement('div');
    fly.className = 'fly';
    fly.style.setProperty('--col', data.col);
    fly.textContent = text;
    document.body.appendChild(fly);

    const startX = compRect.left + compRect.width*0.55 - fly.offsetWidth/2;
    const startY = compRect.top + 12;
    const endX   = targetRect.left + 8;
    const endY   = targetRect.top  + 8;

    fly.style.transform = `translate(${startX}px, ${startY}px)`;
    fly.style.opacity = '0.95';

    fly.animate([
      { transform:`translate(${startX}px, ${startY}px) scale(1)`, opacity:.95, offset:0 },
      { transform:`translate(${(startX+endX)/2}px, ${(startY+endY)/2 - 80}px) scale(1.06)`, opacity:1, offset:.6 },
      { transform:`translate(${endX}px, ${endY}px) scale(1)`, opacity:1, offset:1 }
    ], { duration: 750, easing:'cubic-bezier(.2,.7,.2,1)' }).onfinish = () => {
      document.body.removeChild(fly);
      real.style.visibility = 'visible';
      real.animate([{transform:'scale(.96)',opacity:.0},{transform:'scale(1)',opacity:1}],{duration:180,easing:'ease-out'});

      // persist
      const tiles = load(); tiles.push(data); save(tiles);
      localStorage.setItem(RATE_KEY, String(now));

      // reset
      msg.value = ''; nameI.value=''; tone.value=''; ok.checked=false; update();

      // keep new tile in view
      real.scrollIntoView({ behavior:'smooth', block:'nearest' });
    };
  });
</script>
</body>
</html>