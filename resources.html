<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>U.S. Voting Info Map ‚Äî Aim the Light</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{ --ink:#f8fafc; --muted:#cbd5e1; --bg:#0b1020; --panel:#101827; --border:#233047; --accent:#fbbf24; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  a{color:var(--accent);text-decoration:none}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  header{position:sticky;top:0;background:linear-gradient(180deg, rgba(11,16,32,.92), rgba(11,16,32,.6));
    backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid rgba(35,48,71,.7);z-index:10}
  .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
  .brand a{font-weight:800;color:var(--ink)}
  .brand small{color:var(--muted);font-weight:600;opacity:.85}
  .hero{padding:22px 16px;border-bottom:1px solid var(--border)}
  .hero h1{margin:.1rem 0 .25rem;font-size:clamp(1.6rem,1.2rem + 2vw,2.2rem)}
  .hero p{color:var(--muted);margin:.25rem 0 0}
  .card{margin:18px 0;padding:14px;border:1px solid var(--border);border-radius:14px;background:linear-gradient(180deg,#101827,#0e182d)}
  .map-wrap{position:relative;overflow:hidden;border-radius:14px;border:1px solid var(--border);background:#0c1426}
  .map-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border)}
  .map-head h2{margin:0;font-size:1.05rem}
  .map-body{padding:6px;min-height:460px;display:grid;place-items:center}
  #map-root svg{display:block;width:100%;height:auto}
  .note{margin-top:10px;color:#9fb0cc;font-size:.92rem}
  footer{padding:28px 0;color:#9fb0cc;text-align:center;border-top:1px solid var(--border);margin-top:22px}
  .err{padding:10px 12px;margin:10px 0;border:1px solid #7f1d1d;background:#1f0b0b;color:#fecaca;border-radius:8px}
  .ok{display:inline-block;padding:4px 8px;border-radius:999px;background:#083d2b;color:#bff7de;border:1px solid #0a6e4b;font-size:.85rem}
  .bad{display:inline-block;padding:4px 8px;border-radius:999px;background:#4a0e0e;color:#fecaca;border:1px solid #8a1c1c;font-size:.85rem}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.55rem}
</style>
</head>
<body>
<header>
  <div class="nav container">
    <div class="brand"><a href="index.html">Aim the Light</a><br><small>U.S. Voting Info Map (MVP)</small></div>
    <nav class="links"><a href="index.html">Home</a></nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h1>Find Your Official Voting Information</h1>
    <p>Click your state for quick links to registration and your state‚Äôs election office. We link only to official sources.</p>
  </section>

  <!-- Diagnostics -->
  <section class="card" id="diag">
    <h2 style="margin:4px 0 10px;font-size:1.05rem">Diagnostics</h2>
    <div class="grid">
      <div>React: <span id="chk-react" class="bad">not loaded</span></div>
      <div>ReactDOM: <span id="chk-reactdom" class="bad">not loaded</span></div>
      <div>react-simple-maps: <span id="chk-rsm" class="bad">not loaded</span></div>
      <div>TopoJSON fetch: <span id="chk-topo" class="bad">not started</span></div>
    </div>
    <div id="diag-msg" class="note" style="margin-top:8px"></div>
  </section>

  <section class="card">
    <div class="map-wrap">
      <div class="map-head">
        <h2>United States</h2>
        <small style="color:#9fb0cc">Keyboard: Tab to focus a state, Enter to open</small>
      </div>
      <div id="map-root" class="map-body" aria-live="polite">
        <div style="color:#9fb0cc">Initializing‚Ä¶</div>
      </div>
    </div>
    <div id="map-error" class="err" style="display:none"></div>
    <p class="note">We don‚Äôt host deadlines or rules here (they change). Use the official links for the most current guidance.</p>
  </section>
</main>

<footer>¬© <span id="y"></span> Aim the Light</footer>

<!-- Libs -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/react-simple-maps@3.0.0/dist/index.umd.js"></script>

<script>
  // Year
  document.getElementById('y').textContent = new Date().getFullYear();

  // Helpers for UI badges
  const ok = el => { el.textContent = 'ok'; el.className = 'ok'; };
  const bad = (el, txt) => { el.textContent = txt || 'error'; el.className = 'bad'; };
  const chkReact = document.getElementById('chk-react');
  const chkReactDOM = document.getElementById('chk-reactdom');
  const chkRSM = document.getElementById('chk-rsm');
  const chkTopo = document.getElementById('chk-topo');
  const diagMsg = document.getElementById('diag-msg');
  const showError = (msg, err) => {
    const box = document.getElementById('map-error');
    box.style.display = 'block';
    box.textContent = msg;
    if (err) console.error(msg, err);
  };

  // 1) Confirm libs loaded
  if (window.React) ok(chkReact); else bad(chkReact, 'missing');
  if (window.ReactDOM) ok(chkReactDOM); else bad(chkReactDOM, 'missing');
  const RSM = window['reactSimpleMaps'];
  if (RSM) ok(chkRSM); else bad(chkRSM, 'missing');

  // 2) If libs are present, render a SMOKE TEST globe (no data fetch).
  try {
    if (window.React && window.ReactDOM && RSM) {
      const { ComposableMap, Sphere, Graticule } = RSM;
      const root = document.getElementById('map-root');
      const Globe = () => React.createElement(
        ComposableMap,
        { projectionConfig: { scale: 140 }, style: { width: '100%', height: 'auto' } },
        React.createElement(Sphere, { id: "smoke-sphere", fill: "#0b1222", stroke: "#233047" }),
        React.createElement(Graticule, { stroke: "#233047", strokeWidth: 0.4 })
      );
      ReactDOM.createRoot(root).render(React.createElement(Globe));
      diagMsg.textContent = 'Smoke test rendered (globe). If you see a blue globe with grid lines, the libraries are loaded.';
    } else {
      diagMsg.textContent = 'One or more libraries did not load. Check your network/CSP or try a hard refresh.';
    }
  } catch (e) {
    showError('Smoke test failed to render.', e);
  }

  // 3) Fetch TopoJSON and render states
  (async function(){
    try {
      chkTopo.textContent = 'loading‚Ä¶';
      // Use unpkg (CORS-friendly). If your host blocks external scripts via CSP, this may fail silently.
      const url = 'https://unpkg.com/us-atlas@3/states-10m.json';
      const res = await fetch(url, { mode: 'cors' });
      if (!res.ok) throw new Error('HTTP '+res.status+' '+res.statusText);
      ok(chkTopo);
      const topology = await res.json();

      // Modal wiring
      const modal = (() => {
        const root = document.createElement('div');
        root.className = 'modal-backdrop';
        root.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:50;';
        root.innerHTML = `
          <div class="modal" role="document" style="width:min(560px,96vw);border-radius:16px;border:1px solid #233047;background:linear-gradient(180deg,#0f172a,#0b1222);box-shadow:0 25px 80px rgba(0,0,0,.45);color:#f8fafc">
            <div class="hd" style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #233047">
              <h3 id="stateTitle" style="margin:0;font-size:1.1rem">State</h3>
              <button id="closeModal" aria-label="Close" style="background:transparent;border:0;color:#cbd5e1;font-size:1.4rem;cursor:pointer">√ó</button>
            </div>
            <div class="bd" style="padding:16px">
              <p style="margin:.4rem 0;color:#cbd5e1">Use the official portals below for registration and your state‚Äôs election info.</p>
              <div class="btns" style="display:flex;flex-wrap:wrap;gap:.6rem;margin-top:.8rem">
                <a id="voteGov" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .8rem;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:rgba(251,191,36,.12);color:#ffe7a1;font-weight:600;text-decoration:none">üó≥ Vote.gov</a>
                <a id="nass" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .8rem;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:#f8fafc;font-weight:600;text-decoration:none">üèõ NASS ‚Äî Can I Vote</a>
              </div>
            </div>
          </div>`;
        document.body.appendChild(root);
        const title = root.querySelector('#stateTitle');
        const voteGov = root.querySelector('#voteGov');
        const nass = root.querySelector('#nass');
        const closeBtn = root.querySelector('#closeModal');
        function open(name, postal){
          title.textContent = postal ? `${name} (${postal})` : name;
          voteGov.href = 'https://www.vote.gov/';
          nass.href = 'https://www.nass.org/can-I-vote';
          root.style.display = 'flex';
          closeBtn.focus();
        }
        function close(){ root.style.display = 'none'; }
        closeBtn.addEventListener('click', close);
        root.addEventListener('click', (e)=>{ if (e.target === root) close(); });
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
        return { open };
      })();

      const { ComposableMap, Geographies, Geography, Sphere, Graticule } = RSM;
      const MapStates = () => {
        const onSelect = (geo) => {
          const name = geo.properties.name;
          const postal = geo.properties.postal || '';
          modal.open(name, postal);
        };
        const onKey = (e, geo) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onSelect(geo); }
        };
        return React.createElement(
          ComposableMap,
          { projectionConfig: { scale: 850 }, style: { width: '100%', height: 'auto' } },
          React.createElement(Sphere, { fill: "#0b1222", stroke: "#233047" }),
          React.createElement(Graticule, { stroke: "#233047", strokeWidth: .35 }),
          React.createElement(Geographies, { geography: topology }, ({ geographies }) =>
            geographies.map(geo =>
              React.createElement(Geography, {
                key: geo.rsmKey,
                geography: geo,
                onClick: ()=>onSelect(geo),
                onKeyDown: (e)=>onKey(e, geo),
                tabIndex: 0,
                role: "button",
                "aria-label": geo.properties.name,
                style: {
                  default: { fill: "#1f2937", outline: "none" },
                  hover:   { fill: "#334155", outline: "none" },
                  pressed: { fill: "#475569", outline: "none" }
                }
              })
            )
          )
        );
      };

      const root = document.getElementById('map-root');
      ReactDOM.createRoot(root).render(React.createElement(MapStates));
    } catch (err) {
      bad(chkTopo, 'failed');
      showError('Map failed to load. See console for details.', err);
    }
  })();
</script>
</body>
</html>