<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>U.S. Voting Info Map ‚Äî Aim the Light</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#f8fafc; --muted:#cbd5e1; --bg:#0b1020; --panel:#101827; --border:#233047; --accent:#fbbf24;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;background:linear-gradient(180deg, rgba(11,16,32,.92), rgba(11,16,32,.6));
      backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid rgba(35,48,71,.7);z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
    .brand a{font-weight:800;color:var(--ink)}
    .brand small{color:var(--muted);font-weight:600;opacity:.85}
    .hero{padding:22px 16px;border-bottom:1px solid var(--border)}
    .hero h1{margin:.1rem 0 .25rem;font-size:clamp(1.6rem,1.2rem + 2vw,2.2rem)}
    .hero p{color:var(--muted);margin:.25rem 0 0}
    .card{margin:18px 0;padding:14px;border:1px solid var(--border);border-radius:14px;background:linear-gradient(180deg,#101827,#0e182d)}
    /* Map wrapper */
    .map-wrap{position:relative;overflow:hidden;border-radius:14px;border:1px solid var(--border);background:#0c1426}
    .map-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border)}
    .map-head h2{margin:0;font-size:1.05rem}
    .map-body{padding:6px;min-height:440px;display:grid;place-items:center}
    #map-root svg{display:block;width:100%;height:auto}
    .loading{color:#9fb0cc;font-size:.98rem}
    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;padding:16px;z-index:50;
    }
    .modal-backdrop.open{display:flex}
    .modal{
      width:min(560px,96vw);border-radius:16px;border:1px solid var(--border);
      background:linear-gradient(180deg,#0f172a,#0b1222);box-shadow:0 25px 80px rgba(0,0,0,.45);
      color:var(--ink)
    }
    .modal header{position:unset;border:0;background:transparent;backdrop-filter:none}
    .modal .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .modal .hd h3{margin:0;font-size:1.1rem}
    .modal .bd{padding:16px}
    .modal .bd p{margin:.4rem 0;color:var(--muted)}
    .btns{display:flex;flex-wrap:wrap;gap:.6rem;margin-top:.8rem}
    .btn{
      display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .8rem;border-radius:12px;
      border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);
      color:var(--ink);font-weight:600;text-decoration:none;transition:transform .15s ease, border-color .2s ease
    }
    .btn:hover{transform:translateY(-1px);border-color:var(--accent)}
    .btn.primary{background:rgba(251,191,36,.12);border-color:rgba(251,191,36,.45);color:#ffe7a1}
    .close{background:transparent;border:0;color:var(--muted);font-size:1.4rem;cursor:pointer}
    .note{margin-top:10px;color:#9fb0cc;font-size:.92rem}
    .focus-ring:focus{outline:3px solid #93c5fd;outline-offset:2px;border-radius:6px}
    footer{padding:28px 0;color:#9fb0cc;text-align:center;border-top:1px solid var(--border);margin-top:22px}
    .err{padding:10px 12px;margin:10px 0;border:1px solid #7f1d1d;background:#1f0b0b;color:#fecaca;border-radius:8px;display:none}
  </style>
</head>
<body>
  <header>
    <div class="nav container">
      <div class="brand"><a href="index.html">Aim the Light</a><br><small>U.S. Voting Info Map (MVP)</small></div>
      <nav class="links"><a href="index.html">Home</a></nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Find Your Official Voting Information</h1>
      <p>Click your state for quick links to registration and your state‚Äôs election office. We link only to official sources.</p>
    </section>

    <section class="card">
      <div class="map-wrap">
        <div class="map-head">
          <h2>United States</h2>
          <small style="color:#9fb0cc">Keyboard: Tab to focus a state, Enter to open</small>
        </div>
        <div id="map-root" class="map-body" aria-live="polite">
          <div class="loading">Loading map‚Ä¶</div>
        </div>
      </div>
      <div id="map-error" class="err"></div>
      <p class="note">We don‚Äôt host deadlines or rules here (they change). Use the official links for the most current guidance.</p>
    </section>
  </main>

  <div id="modal-root" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div class="hd">
        <h3 id="stateTitle">State</h3>
        <button class="close focus-ring" id="closeModal" aria-label="Close">√ó</button>
      </div>
      <div class="bd">
        <p id="stateDesc">Use the official portals below for registration and state-specific election information.</p>
        <div class="btns">
          <a id="voteGov" class="btn primary focus-ring" target="_blank" rel="noopener">üó≥ Register / Update @ Vote.gov</a>
          <a id="nass" class="btn focus-ring" target="_blank" rel="noopener">üèõ State Election Office (NASS)</a>
        </div>
        <p class="note">Tip: Have your state ID or driver‚Äôs license handy for fastest registration in most states.</p>
      </div>
    </div>
  </div>

  <footer>
    ¬© <span id="y"></span> Aim the Light
  </footer>

  <!-- React + libs (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/react-simple-maps@3.0.0/dist/index.umd.js"></script>

  <script>
    // Footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Error helper
    function showError(msg, err){
      const box = document.getElementById('map-error');
      box.style.display = 'block';
      box.textContent = msg;
      if (err) console.error(msg, err);
    }

    // Modal helpers
    const modal = document.getElementById('modal-root');
    const closeBtn = document.getElementById('closeModal');
    const titleEl = document.getElementById('stateTitle');
    const voteGovEl = document.getElementById('voteGov');
    const nassEl = document.getElementById('nass');

    function linksFor(){ return { voteGov: "https://www.vote.gov/", nass: "https://www.nass.org/can-I-vote" }; }
    function openModal(name, postal){
      const {voteGov, nass} = linksFor(postal);
      titleEl.textContent = `${name}${postal ? ' ('+postal+')' : ''}`;
      voteGovEl.href = voteGov;
      nassEl.href = nass;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      closeBtn.focus();
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    // Load TopoJSON explicitly, then render
    (async function init(){
      try{
        const lib = window['reactSimpleMaps'];
        if(!lib){ throw new Error('react-simple-maps UMD not found (window["reactSimpleMaps"] missing).'); }

        // Fetch TopoJSON (unpkg is very permissive with CORS)
        const geoUrl = "https://unpkg.com/us-atlas@3/states-10m.json";
        const res = await fetch(geoUrl, { mode: 'cors' });
        if(!res.ok){ throw new Error('Failed to fetch TopoJSON: ' + res.status + ' ' + res.statusText); }
        const topology = await res.json(); // pass object directly

        const { ComposableMap, Geographies, Geography } = lib;

        function USMap(){
          const onSelect = (geo) => {
            const name = geo.properties.name;
            const postal = geo.properties.postal || '';
            openModal(name, postal);
          };
          const onKey = (e, geo) => {
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onSelect(geo); }
          };
          return React.createElement(
            ComposableMap,
            { projectionConfig: { scale: 850 } },
            React.createElement(Geographies, { geography: topology }, ({ geographies }) =>
              geographies.map(geo =>
                React.createElement(Geography, {
                  key: geo.rsmKey,
                  geography: geo,
                  onClick: ()=>onSelect(geo),
                  onKeyDown: (e)=>onKey(e, geo),
                  tabIndex: 0,
                  role: "button",
                  "aria-label": geo.properties.name,
                  style: {
                    default: { fill: "#1f2937", outline: "none" },
                    hover:   { fill: "#334155", outline: "none" },
                    pressed: { fill: "#475569", outline: "none" }
                  }
                })
              )
            )
          );
        }

        const root = document.getElementById('map-root');
        root.innerHTML = ""; // clear "Loading‚Ä¶"
        ReactDOM.createRoot(root).render(React.createElement(USMap));
      }catch(err){
        showError('Map failed to load. Open your browser console for details.', err);
      }
    })();
  </script>
</body>
</html>